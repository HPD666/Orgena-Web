<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orgena AI Teacher Assistant (Offline)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    height: 200vh;
    background: #f9f9f9;
  }
  #assistant {
    position: fixed;
    bottom: 20px; right: 20px;
    width: 50px; height: 50px;
    background: #2a5d84;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    cursor: pointer;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.5rem;
    user-select: none;
  }
  #assistant.open {
    width: 360px;
    height: 480px;
    border-radius: 12px;
    background: white;
    flex-direction: column;
    padding: 1rem;
    color: #2a3b54;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  #assistant.open h2 {
    margin: 0 0 0.5rem 0;
    color: #2a5d84;
    font-size: 1.5rem;
  }
  #assistant.open p {
    font-size: 0.9rem;
    margin-top: 0;
    color: #555;
  }
  #chatLog {
    flex-grow: 1;
    overflow-y: auto;
    border: 1px solid #c3d4f7;
    background: #f1f7fd;
    border-radius: 5px;
    padding: 0.5rem;
    font-size: 0.9rem;
    margin: 0.5rem 0 0.75rem 0;
  }
  #chatLog div {
    margin-bottom: 0.5rem;
  }
  #chatLog .user {
    text-align: right;
    font-weight: bold;
    color: #1a1a1a;
  }
  #chatLog .bot {
    text-align: left;
    color: #2a3b54;
  }
  input[type="text"] {
    width: 100%;
    font-size: 1rem;
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }
  button {
    background-color: #2a5d84;
    color: white;
    padding: 0.7rem 1.2rem;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    border-radius: 5px;
    margin-top: 0.5rem;
    width: 100%;
  }
  button:hover {
    background-color: #1f4561;
  }
  #closeBtn {
    position: absolute;
    top: 10px; right: 12px;
    background: transparent;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    color: #2a5d84;
  }
</style>
</head>
<body>

<div id="assistant" title="Click to open Orgena AI Teacher Assistant">?</div>

<script>
  const assistant = document.getElementById('assistant');
  let open = false;

  // Orgena knowledge base â€” expand with all Orgena coding commands and concepts
  const orgenaKB = {
    "orgena": "Orgena is a powerful organizational system designed to streamline workflows and manage projects efficiently.",
    "orgena language": "Orgena uses its own scripting language called OrgLang for automating tasks and workflows.",
    "orgena code": "Orgena code includes commands such as 'create_task', 'assign_user', 'set_deadline', 'track_progress', and 'generate_report'.",
    "create_task": "The 'create_task' command creates a new task in Orgena. Syntax: create_task 'task name' [options]",
    "assign_user": "The 'assign_user' command assigns a user to a task. Syntax: assign_user 'task id' 'user id'",
    "set_deadline": "Use 'set_deadline' to set the due date of a task. Syntax: set_deadline 'task id' 'YYYY-MM-DD'",
    "track_progress": "The 'track_progress' command tracks the progress of tasks and updates their status automatically.",
    "generate_report": "Use 'generate_report' to create detailed project reports. Syntax: generate_report 'project id' [filters]",
    "orglang": "OrgLang is Orgena's scripting language that supports variables, loops, conditionals, functions, and error handling.",
    "variables": "Declare variables in OrgLang using: var variableName = value;",
    "loops": "Loops in OrgLang follow this syntax: for (var i = 0; i < count; i++) { ... }",
    "conditions": "Conditional statements use if/else syntax: if (condition) { ... } else { ... }",
    "functions": "Define functions with: function functionName(params) { ... }",
    "error handling": "OrgLang supports try/catch blocks for managing errors during script execution.",
    "project": "A project in Orgena groups related tasks, users, and deadlines together.",
    "task": "Tasks represent individual units of work inside a project.",
    "user": "Users can be assigned tasks and have roles such as admin, editor, or viewer.",
    "automation": "Orgena supports automation scripts to simplify repetitive tasks and workflows.",
    "integration": "Orgena can integrate with external services and APIs to extend functionality.",
    "syntax": "OrgLang syntax is similar to JavaScript but optimized for task and project management.",
    "example code": `Example Orgena code:
create_task "Write user manual"
assign_user "task001" "user123"
set_deadline "task001" "2025-07-01"
track_progress "task001"
generate_report "project789" status:completed`
  };

  // Helper to find best answer in Orgena KB
  function findAnswer(question) {
    question = question.toLowerCase();

    // Try exact or partial keyword matches first
    for (const key in orgenaKB) {
      if (question.includes(key)) {
        return orgenaKB[key];
      }
    }

    // If question mentions coding Orgena generally
    if (question.includes("how to") && question.includes("orgena")) {
      return "To code in Orgena, use OrgLang scripting language designed for managing projects and tasks. You can create tasks, assign users, set deadlines, automate workflows, and generate reports. Ask me about specific commands or scripting concepts!";
    }

    if (question.includes("example") || question.includes("sample")) {
      if (question.includes("orgena")) {
        return orgenaKB["example code"];
      }
    }

    if (!question.trim()) return "Please type a question about coding in Orgena.";

    // Default fallback
    return "Sorry, I don't have an answer for that question about Orgena coding yet. Try asking about specific commands or features!";
  }

  // Expand assistant UI
  function openAssistant() {
    open = true;
    assistant.classList.add('open');
    assistant.innerHTML = `
      <button id="closeBtn" title="Close assistant">&times;</button>
      <h2>Orgena AI Teacher Assistant</h2>
      <p>Ask me anything about coding in Orgena!</p>
      <div id="chatLog" aria-live="polite" aria-atomic="true"></div>
      <input type="text" id="questionInput" placeholder="Type your question here and press Enter" aria-label="Question input"/>
      <button id="askBtn">Ask</button>
    `;

    document.getElementById('closeBtn').onclick = () => {
      open = false;
      assistant.classList.remove('open');
      assistant.textContent = "?";
    };

    const askBtn = document.getElementById('askBtn');
    const input = document.getElementById('questionInput');
    const chatLog = document.getElementById('chatLog');

    function addMessage(text, fromUser = false) {
      const msg = document.createElement('div');
      msg.className = fromUser ? 'user' : 'bot';
      msg.textContent = text;
      chatLog.appendChild(msg);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function handleQuestion() {
      const question = input.value.trim();
      if (!question) return;
      addMessage(question, true);
      input.value = '';
      setTimeout(() => {
        const answer = findAnswer(question);
        addMessage(answer, false);
      }, 400);
    }

    askBtn.onclick = handleQuestion;
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        handleQuestion();
      }
    });

    input.focus();
  }

  assistant.addEventListener('click', () => {
    if (!open) openAssistant();
  });
</script>

</body>
</html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Orgena Workspace</title>
  <style>
    body { background: #222733; color: #eee; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 40px auto; background: #181a20; border-radius: 10px; box-shadow: 0 0 10px #0007; padding: 32px 36px; }
    h1, h2 { color: #97c1ff; }
    pre, textarea { background: #232733; color: #fff; border: none; border-radius: 4px; padding: 10px; font-size: 1em; }
    textarea { width: 100%; min-height: 420px; font-family: 'Fira Mono', 'Consolas', monospace; margin-bottom: 1em; font-size: 1.08em; }
    button { background: #3c8dde; color: #fff; border: none; border-radius: 5px; padding: 10px 24px; font-size: 1.1em; cursor: pointer; margin-bottom: 20px; }
    button:hover { background: #2767a6; }
    #output { background: #1a1d22; color: #9afc9a; border-radius: 4px; padding: 12px; min-height: 2em; white-space: pre-wrap; font-size: 1em; }
    a { color: #7ea6ff; }
    hr { border: none; border-bottom: 1px solid #333; margin: 32px 0; }
    #promptInput { display: none; }
    #orgenaElements { margin-top: 24px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Orgena Workspace</h1>
    <form onsubmit="runOrgena(); return false;">
      <b>Code:</b>
      <textarea id="code" spellcheck="false">
// Try Orgena's new HTML features!
Create Element button as myBtn
Set text of myBtn to "Say Hello!"
Add myBtn to page
On click of myBtn, run
  Say "Hello from Orgena and HTML!"
end
      </textarea><br>
      <button type="submit">Run Orgena</button>
    </form>
    <input id="promptInput" type="text" placeholder="Type your answer and press Enter...">
    <div id="output"></div>
    <div id="orgenaElements"></div>
    <hr>
    <div style="font-size:0.95em; color:#aaa;">
      Orgena is open source! See <a href="https://github.com/HPD666/Orgena-Web" target="_blank">GitHub</a>.
    </div>
  </div>
  <script>
    function runOrgena() {
      const code = document.getElementById('code').value;
      const lines = code.replace(/\r\n/g, '\n').split('\n');
      let vars = Object.create(null);
      let output = '';
      let functions = {};
      let pc = 0;
      let awaitingInput = false;
      let inputVarName = '';
      let inputCallback = null;
      let orgenaElements = Object.create(null); // For HTML elements
      let eventBlocks = []; // For storing event handlers

      // Clear previous Orgena-created HTML
      document.getElementById('orgenaElements').innerHTML = '';

      function evalExpr(expr) {
        expr = expr.trim();
        if (/^"([^"]*)"$/i.test(expr)) return expr.replace(/^"|"$/g, "");
        if (/^sqrt of (.+)$/i.test(expr)) return Math.sqrt(evalExpr(expr.match(/^sqrt of (.+)$/i)[1]));
        if (/^abs of (.+)$/i.test(expr)) return Math.abs(evalExpr(expr.match(/^abs of (.+)$/i)[1]));
        if (/^Random between (.+) and (.+)$/i.test(expr)) {
          let m = expr.match(/^Random between (.+) and (.+)$/i);
          let min = parseFloat(evalExpr(m[1])), max = parseFloat(evalExpr(m[2]));
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        if (/^floor (.+)$/i.test(expr)) return Math.floor(evalExpr(expr.match(/^floor (.+)$/i)[1]));
        if (/^ceil (.+)$/i.test(expr)) return Math.ceil(evalExpr(expr.match(/^ceil (.+)$/i)[1]));
        if (/^round (.+)$/i.test(expr)) return Math.round(evalExpr(expr.match(/^round (.+)$/i)[1]));
        if (/^power (.+) (.+)$/i.test(expr)) { let m=expr.match(/^power (.+) (.+)$/i); return Math.pow(evalExpr(m[1]),evalExpr(m[2])); }
        if (/^modulo (.+) (.+)$/i.test(expr)) { let m=expr.match(/^modulo (.+) (.+)$/i); return evalExpr(m[1])%evalExpr(m[2]); }
        if (/^log (.+)$/i.test(expr)) return Math.log10(evalExpr(expr.match(/^log (.+)$/i)[1]));
        if (/^exp (.+)$/i.test(expr)) return Math.exp(evalExpr(expr.match(/^exp (.+)$/i)[1]));
        if (/^sin (.+)$/i.test(expr)) return Math.sin(evalExpr(expr.match(/^sin (.+)$/i)[1]));
        if (/^cos (.+)$/i.test(expr)) return Math.cos(evalExpr(expr.match(/^cos (.+)$/i)[1]));
        if (/^tan (.+)$/i.test(expr)) return Math.tan(evalExpr(expr.match(/^tan (.+)$/i)[1]));
        if (/^Now$/i.test(expr)) return new Date().toLocaleString();
        if (/^current time$/i.test(expr)) return new Date().toLocaleTimeString();
        if (/^current date$/i.test(expr)) return new Date().toLocaleDateString();
        if (/^([a-zA-Z_]\w*) at (\d+)$/i.test(expr)) {
          let m = expr.match(/^([a-zA-Z_]\w*) at (\d+)$/i);
          let arr = vars[m[1]];
          let idx = parseInt(m[2]) - 1;
          if (Array.isArray(arr) && idx >= 0 && idx < arr.length) return arr[idx];
          else return '';
        }
        if (/^Uppercase (.+)$/i.test(expr)) { let s=evalExpr(expr.match(/^Uppercase (.+)$/i)[1]); return String(s).toUpperCase();}
        if (/^Lowercase (.+)$/i.test(expr)) { let s=evalExpr(expr.match(/^Lowercase (.+)$/i)[1]); return String(s).toLowerCase();}
        if (/^Substring (.+) from (\d+) to (\d+)$/i.test(expr)) {
          let m=expr.match(/^Substring (.+) from (\d+) to (\d+)$/i);
          let s=evalExpr(m[1]), a=parseInt(m[2])-1, b=parseInt(m[3]);
          return String(s).substring(a,b);
        }
        if (/^Contains (.+) in (.+)$/i.test(expr)) {
          let m=expr.match(/^Contains (.+) in (.+)$/i); let a=evalExpr(m[1]), b=evalExpr(m[2]);
          return String(b).includes(String(a));
        }
        if (/^Repeat (.+) (\d+) times$/i.test(expr)) {
          let m=expr.match(/^Repeat (.+) (\d+) times$/i); let s=evalExpr(m[1]), n=parseInt(m[2]);
          return String(s).repeat(n);
        }
        if (/^Trim (.+)$/i.test(expr)) { let s=evalExpr(expr.match(/^Trim (.+)$/i)[1]); return String(s).trim();}
        if (/^Pad (.+) to (\d+) with (.+)$/i.test(expr)) {
          let m=expr.match(/^Pad (.+) to (\d+) with (.+)$/i); let s=evalExpr(m[1]), n=parseInt(m[2]), chr=evalExpr(m[3]);
          return String(s).padStart(n,chr);
        }
        if (/^Starts with (.+) in (.+)$/i.test(expr)) {
          let m=expr.match(/^Starts with (.+) in (.+)$/i); let a=evalExpr(m[1]), b=evalExpr(m[2]);
          return String(b).startsWith(String(a));
        }
        if (/^Ends with (.+) in (.+)$/i.test(expr)) {
          let m=expr.match(/^Ends with (.+) in (.+)$/i); let a=evalExpr(m[1]), b=evalExpr(m[2]);
          return String(b).endsWith(String(a));
        }
        if (/^Random choice from ([a-zA-Z_]\w*)$/i.test(expr)) {
          let m = expr.match(/^Random choice from ([a-zA-Z_]\w*)$/i);
          let arr = vars[m[1]];
          if (Array.isArray(arr) && arr.length>0) return arr[Math.floor(Math.random()*arr.length)];
          return "";
        }
        expr = expr.replace(/ plus /gi, ' + ')
                   .replace(/ minus /gi, ' - ')
                   .replace(/ times /gi, ' * ')
                   .replace(/ multiplied by /gi, ' * ')
                   .replace(/ divided by /gi, ' / ')
                   .replace(/ mod /gi, ' % ');
        expr = expr.replace(/\b[a-zA-Z_]\w*\b/g, function(name){
          if (Object.prototype.hasOwnProperty.call(vars, name)) return vars[name];
          return name;
        });
        try { return eval(expr); }
        catch { return expr; }
      }

      function parseCondition(cond) {
        cond = cond.trim();
        let m = cond.match(/(.+) is (greater than|less than|equal to|equals|not equal to|not equals) (.+)/i);
        if (!m) return false;
        let left = evalExpr(m[1]);
        let op = m[2].toLowerCase();
        let right = evalExpr(m[3]);
        if (op === 'greater than') return left > right;
        if (op === 'less than') return left < right;
        if (op === 'equal to' || op === 'equals') return left == right;
        if (op === 'not equal to' || op === 'not equals') return left != right;
        return false;
      }

      function runBlock(start) {
        let block = [];
        let indent = lines[start].match(/^(\s*)/)[1].length;
        let i = start;
        for (; i < lines.length; i++) {
          let line = lines[i];
          if (line.trim().toLowerCase() === 'end') break;
          if (i !== start && line.match(/^(\s*)/)[1].length <= indent) break;
          block.push(line.replace(new RegExp(`^ {0,${indent}}`), ''));
        }
        return { block, next: i+1 };
      }

      function execBlock(blockLines, localVars={}) {
        let oldVars = Object.assign({}, vars);
        Object.assign(vars, localVars);
        for (let l = 0; l < blockLines.length; l++) {
          execLine(blockLines[l]);
        }
        vars = oldVars;
      }

      function execLine(line) {
        line = line.trim();
        if (line === '' || line.startsWith('//') || line.startsWith('#')) return;

        // --- HTML Extension Start ---

        // Create Element <type> as <name>
        if (/^Create Element ([a-zA-Z0-9]+) as ([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Create Element ([a-zA-Z0-9]+) as ([a-zA-Z_]\w*)$/i);
          let tag = m[1], name = m[2];
          let el = document.createElement(tag);
          el.style.margin = "6px";
          orgenaElements[name] = el;
          return;
        }

        // Set text of <name> to <value>
        if (/^Set text of ([a-zA-Z_]\w*) to (.+)$/i.test(line)) {
          let m = line.match(/^Set text of ([a-zA-Z_]\w*) to (.+)$/i);
          let name = m[1], val = evalExpr(m[2]);
          if (orgenaElements[name]) orgenaElements[name].textContent = val;
          return;
        }

        // Set attribute <attr> of <name> to <value>
        if (/^Set attribute ([a-zA-Z0-9\-_]+) of ([a-zA-Z_]\w*) to (.+)$/i.test(line)) {
          let m = line.match(/^Set attribute ([a-zA-Z0-9\-_]+) of ([a-zA-Z_]\w*) to (.+)$/i);
          let attr = m[1], name = m[2], val = evalExpr(m[3]);
          if (orgenaElements[name]) orgenaElements[name].setAttribute(attr, val);
          return;
        }

        // Set style of <name> to <css>
        if (/^Set style of ([a-zA-Z_]\w*) to (.+)$/i.test(line)) {
          let m = line.match(/^Set style of ([a-zA-Z_]\w*) to (.+)$/i);
          let name = m[1], css = evalExpr(m[2]);
          if (orgenaElements[name]) orgenaElements[name].style.cssText += ";" + css;
          return;
        }

        // Add <name> to page
        if (/^Add ([a-zA-Z_]\w*) to page$/i.test(line)) {
          let m = line.match(/^Add ([a-zA-Z_]\w*) to page$/i);
          let name = m[1];
          if (orgenaElements[name]) document.getElementById('orgenaElements').appendChild(orgenaElements[name]);
          return;
        }

        // Remove <name> from page
        if (/^Remove ([a-zA-Z_]\w*) from page$/i.test(line)) {
          let m = line.match(/^Remove ([a-zA-Z_]\w*) from page$/i);
          let name = m[1];
          if (orgenaElements[name] && orgenaElements[name].parentElement) orgenaElements[name].parentElement.removeChild(orgenaElements[name]);
          return;
        }

        // Show <name>
        if (/^Show ([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Show ([a-zA-Z_]\w*)$/i);
          let name = m[1];
          if (orgenaElements[name]) orgenaElements[name].style.display = '';
          return;
        }

        // Hide <name>
        if (/^Hide ([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Hide ([a-zA-Z_]\w*)$/i);
          let name = m[1];
          if (orgenaElements[name]) orgenaElements[name].style.display = 'none';
          return;
        }

        // On click of <name>, run ... end
        if (/^On click of ([a-zA-Z_]\w*), run$/i.test(line)) {
          let m = line.match(/^On click of ([a-zA-Z_]\w*), run$/i);
          let name = m[1];
          let { block, next } = runBlock(pc);
          if (orgenaElements[name]) {
            orgenaElements[name].onclick = function() {
              try { execBlock(block); }
              catch(e) { if (e !== 'PAUSE_FOR_INPUT') throw e; }
              document.getElementById('output').textContent = output || '(no output)';
            }
          }
          pc = next - 1;
          return;
        }

        // --- HTML Extension End ---

        if (/^Say\s+(.+)/i.test(line)) {
          let expr = line.match(/^Say\s+(.+)/i)[1];
          output += evalExpr(expr) + '\n';
        }
        else if (/^Remember\s+([a-zA-Z_]\w*)\s+is\s+(.+)/i.test(line)) {
          let m = line.match(/^Remember\s+([a-zA-Z_]\w*)\s+is\s+(.+)/i);
          vars[m[1]] = evalExpr(m[2]);
        }
        else if (/^If\s+(.+?),\s*(.+)\s+else\s+(.+)$/i.test(line)) {
          let m = line.match(/^If\s+(.+?),\s*(.+)\s+else\s+(.+)$/i);
          if (parseCondition(m[1])) execLine(m[2]);
          else execLine(m[3]);
        }
        else if (/^If\s+(.+?),\s*(.+)$/i.test(line)) {
          let m = line.match(/^If\s+(.+?),\s*(.+)$/i);
          if (parseCondition(m[1])) execLine(m[2]);
        }
        else if (/^Repeat while\s+(.+?),?$/i.test(line)) {
          let m = line.match(/^Repeat while\s+(.+?),?$/i);
          let { block, next } = runBlock(pc);
          while (parseCondition(m[1])) {
            execBlock(block);
          }
          pc = next - 1;
        }
        else if (/^Define\s+([a-zA-Z_]\w*)\s+with\s+([a-zA-Z_, ]+),?$/i.test(line)) {
          let m = line.match(/^Define\s+([a-zA-Z_]\w*)\s+with\s+([a-zA-Z_, ]+),?$/i);
          let fname = m[1], params = m[2].split(',').map(s=>s.trim());
          let { block, next } = runBlock(pc);
          functions[fname] = { params, block };
          pc = next - 1;
        }
        else if (/^Call\s+([a-zA-Z_]\w*)\s+with\s+(.+)$/i.test(line)) {
          let m = line.match(/^Call\s+([a-zA-Z_]\w*)\s+with\s+(.+)$/i);
          let fname = m[1], args = m[2].split(',').map(s=>evalExpr(s.trim()));
          if (functions[fname]) {
            let localVars = {};
            functions[fname].params.forEach((p, i) => localVars[p] = args[i]);
            execBlock(functions[fname].block, localVars);
          }
        }
        else if (/^([a-zA-Z_]\w*)\s+is\s+(.+)/i.test(line)) {
          let m = line.match(/^([a-zA-Z_]\w*)\s+is\s+(.+)/i);
          vars[m[1]] = evalExpr(m[2]);
        }
        else if (/^Add\s+(.+)\s+to\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Add\s+(.+)\s+to\s+([a-zA-Z_]\w*)$/i);
          let value = evalExpr(m[1]);
          let listName = m[2];
          if (!Array.isArray(vars[listName])) vars[listName] = [];
          vars[listName].push(value);
        }
        else if (/^Remove\s+(.+)\s+from\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Remove\s+(.+)\s+from\s+([a-zA-Z_]\w*)$/i);
          let value = evalExpr(m[1]);
          let listName = m[2];
          if (Array.isArray(vars[listName])) {
            vars[listName] = vars[listName].filter(item => item != value);
          }
        }
        else if (/^Show\s+([a-zA-Z_]\w*)$/i.test(line)) {
          // If not a DOM element, treat as list show (original behavior)
          let m = line.match(/^Show\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            output += listName + ': ' + vars[listName].join(', ') + '\n';
          } else if (!orgenaElements[listName]) {
            output += listName + ' is not a list\n';
          }
        }
        else if (/^Hide\s+([a-zA-Z_]\w*)$/i.test(line)) {
          // If not a DOM element, skip (original behavior)
        }
        else if (/^Clear\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Clear\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) vars[listName] = [];
        }
        else if (/^Count\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Count\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            output += listName + ' count: ' + vars[listName].length + '\n';
          } else {
            output += listName + ' is not a list\n';
          }
        }
        else if (/^For each\s+([a-zA-Z_]\w*)\s+in\s+([a-zA-Z_]\w*),?$/i.test(line)) {
          let m = line.match(/^For each\s+([a-zA-Z_]\w*)\s+in\s+([a-zA-Z_]\w*),?$/i);
          let itemVar = m[1], listName = m[2];
          let { block, next } = runBlock(pc);
          if (Array.isArray(vars[listName])) {
            for (let v of vars[listName]) {
              let localVars = {};
              localVars[itemVar] = v;
              execBlock(block, localVars);
            }
          }
          pc = next - 1;
        }
        else if (/^Join\s+([a-zA-Z_]\w*)\s+with\s+(.+)$/i.test(line)) {
          let m = line.match(/^Join\s+([a-zA-Z_]\w*)\s+with\s+(.+)$/i);
          let listName = m[1], sep = evalExpr(m[2]);
          if (Array.isArray(vars[listName])) {
            vars[listName+"_joined"] = vars[listName].join(sep);
          }
        }
        else if (/^Concat\s+([a-zA-Z_]\w*)\s+with\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Concat\s+([a-zA-Z_]\w*)\s+with\s+([a-zA-Z_]\w*)$/i);
          let a = m[1], b = m[2];
          if (Array.isArray(vars[a]) && Array.isArray(vars[b])) {
            vars[a] = vars[a].concat(vars[b]);
          }
        }
        else if (/^Unique\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Unique\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars[listName] = [...new Set(vars[listName])];
          }
        }
        else if (/^Reverse\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Reverse\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars[listName].reverse();
          }
        }
        else if (/^Sort\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Sort\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars[listName].sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));
          }
        }
        else if (/^Slice\s+([a-zA-Z_]\w*)\s+from\s+(\d+)\s+to\s+(\d+)$/i.test(line)) {
          let m = line.match(/^Slice\s+([a-zA-Z_]\w*)\s+from\s+(\d+)\s+to\s+(\d+)$/i);
          let listName = m[1], a = parseInt(m[2])-1, b = parseInt(m[3]);
          if (Array.isArray(vars[listName])) {
            vars[listName+"_sliced"] = vars[listName].slice(a, b);
          }
        }
        else if (/^Replace\s+(.+)\s+with\s+(.+)\s+in\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Replace\s+(.+)\s+with\s+(.+)\s+in\s+([a-zA-Z_]\w*)$/i);
          let old = evalExpr(m[1]), val = evalExpr(m[2]), listName = m[3];
          if (Array.isArray(vars[listName])) {
            vars[listName] = vars[listName].map(x => x==old?val:x);
          }
        }
        else if (/^Sum\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Sum\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars.sum_result = vars[listName].map(Number).reduce((a,b)=>a+b,0);
          }
        }
        else if (/^Product\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Product\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars.product_result = vars[listName].map(Number).reduce((a,b)=>a*b,1);
          }
        }
        else if (/^Min\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Min\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars.min_result = Math.min(...vars[listName]);
          }
        }
        else if (/^Max\s+([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Max\s+([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) {
            vars.max_result = Math.max(...vars[listName]);
          }
        }
        else if (/^Index of (.+) in ([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Index of (.+) in ([a-zA-Z_]\w*)$/i);
          let val = evalExpr(m[1]), listName = m[2];
          if (Array.isArray(vars[listName])) {
            vars.index_result = vars[listName].indexOf(val)+1;
          }
        }
        else if (/^Length of ([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Length of ([a-zA-Z_]\w*)$/i);
          let listName = m[1];
          if (Array.isArray(vars[listName])) vars.length_result = vars[listName].length;
        }
        else if (/^Ask for ([a-zA-Z_]\w*)$/i.test(line)) {
          let m = line.match(/^Ask for ([a-zA-Z_]\w*)$/i);
          awaitingInput = true;
          inputVarName = m[1];
          inputCallback = function(val) {
            vars[inputVarName] = val;
            awaitingInput = false;
            runInterpreter(pc + 1);
          };
          showPromptInput();
          throw 'PAUSE_FOR_INPUT';
        }
      }

      function runInterpreter(startAt) {
        document.getElementById('output').textContent = '';
        output = '';
        try {
          for (pc = startAt || 0; pc < lines.length; pc++) {
            execLine(lines[pc]);
          }
        } catch(e) {
          if (e !== 'PAUSE_FOR_INPUT') throw e;
        }
        document.getElementById('output').textContent = output || '(no output)';
      }

      function showPromptInput() {
        let input = document.getElementById('promptInput');
        input.style.display = 'block';
        input.value = '';
        input.focus();
        input.onkeydown = function(ev) {
          if (ev.key === 'Enter') {
            let val = input.value;
            input.style.display = 'none';
            if (inputCallback) inputCallback(val);
          }
        };
      }
      runInterpreter(0);
    }
    runOrgena();
  </script>
</body>
</html>
